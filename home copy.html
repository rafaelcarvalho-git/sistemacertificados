<?php //include('modals/verificar_acesso.php'); ?>
<!doctype html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<meta name="author" content="Rafael Carvalho">
<meta name="description" content="Sistema solicitar certificados">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>SisCert</title>    
<link rel="stylesheet" href="css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
<link rel="shortcut icon" type="imagex/png" href="css/icon.ico">
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary" aria-label="Fourth navbar example">
    <div class="container-fluid container">
      <img src="css/logo.png" alt="" width="50" height="32" class="d-inline-block align-text-top ms-5"><a class="navbar-brand mx-auto ms-2" href="home.php">SISTEMA CERTIFICADOS</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button><style>@media(max-width:770px){.navbar-brand{display:none;}}</style>
      <div class="collapse navbar-collapse" id="navbarsExample04">
        <ul class="navbar-nav mx-auto">
          <li class="nav-item dropdown">
            <a class="nav-link text-white dropdown-toggle" href="" id="dropdownSolicitacoes" data-bs-toggle="dropdown" aria-expanded="false">Solicitações</a>
            <ul class="dropdown-menu" aria-labelledby="dropdownSolicitacoes">
              <li><a class="dropdown-item" href="" data-bs-toggle="modal" data-bs-target="#solicitarCertificado">Nova Solicitação</a></li>
              <li><a class="dropdown-item" href="solicitacoes.php">Listar Solicitações</a></li>   
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white position-relative" href="" data-bs-toggle="modal" data-bs-target="#vencimentos">Vencimentos</a>
          </li>
          <li class="nav-item dropdown">
            <a class="nav-link text-white dropdown-toggle" href="" id="dropdownUsuarios" data-bs-toggle="dropdown" aria-expanded="false">Usuários</a>
            <ul class="dropdown-menu" aria-labelledby="dropdownUsuarios">
              <li><a class="dropdown-item" href="" data-bs-toggle="modal" data-bs-target="#cadastrarUsuario">Cadastrar Usuário</a></li>
              <li><a class="dropdown-item" href="usuarios.php">Listar Usuários</a></li>
            </ul>
          </li>
          <li class="nav-item">
            <a class="nav-link text-white" href="" data-bs-toggle="modal" data-bs-target="#sairSistema">Sair</a>  
          </li>  
        </ul>
      </div>
    </div>
</nav>
<header class="container py-4 text-center">
  <h3 class="text-center mx-auto pb-1">Olá, <strong>afd</strong>. Seja bem vindo(a).</h3>     
  <h2>Sistema E2S Corretora de Seguros - Certificadora Digital</h2>
  <p class="lead">Informações sobre certificados digitais, parceiros e negócios futuros.</p>        
</header>
<?php
  include_once("modals/conexao.php");  
  $mes = date("m");$mes++;
  $ano = date("Y");

  $total = "SELECT count(*) FROM solicitacoes_concluidas";   
  $t = mysqli_query($connect, $total);
  if($t === FALSE) { 
    die(mysqli_error($connect));
  }

  $total3 = "SELECT count(*) FROM solicitacoes_ativas";   
  $t3 = mysqli_query($connect, $total3);
  if($t3 === FALSE) { 
    die(mysqli_error($connect));
  }

  $total2 = "SELECT count(*) FROM usuarios WHERE privilegio = 'Contador'";   
  $t2 = mysqli_query($connect, $total2);
  if($t2 === FALSE) { 
    die(mysqli_error($connect));
  }

  $total4 = "SELECT count(*) FROM solicitacoes_concluidas where year(data_vencimento) = '$ano' and month(data_vencimento) = '0$mes' AND renovado = 0 ORDER BY id DESC";     
  $t4 = mysqli_query($connect, $total4);
  if($t4 === FALSE) { 
    die(mysqli_error($connect));
  }
?>
<main class="container">
  <section class="d-flex mx-auto justify-content-evenly">
    <div class="card" style="width:16rem;height:8rem;">
      <div class="card-body">
        <h5 class="card-title">Total de Certificados</h5>
        <h2 class="card-text"><?php while($tt=mysqli_fetch_assoc($t)){echo $tt['count(*)'];}?></h2>
      </div>
    </div>

    <div class="card" style="width:16rem;height:8rem;">
      <div class="card-body">
        <h5 class="card-title">Solicitações Ativas</h5>
        <h2 class="card-text"><?php while($tt=mysqli_fetch_assoc($t)){echo $tt['count(*)'];}?></h2>
      </div>
    </div>

    <div class="card" style="width:16rem;height:8rem;">
      <div class="card-body">
        <h5 class="card-title">Total de Parceiros</h5>
        <h2 class="card-text"><?php while($tt2=mysqli_fetch_assoc($t2)){echo $tt2['count(*)'];}?></h2>
      </div>
    </div>

    <div class="card" style="width:16rem;height:8rem;">
      <div class="card-body">
        <h5 class="card-title">Total Vencimentos do Mês</h5>
        <h2 class="card-text"><?php while($tt4=mysqli_fetch_assoc($t4)){echo $tt4['count(*)'];}?></h2>
      </div>
    </div>
  </section>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
  google.charts.load("current", {packages:["corechart"]});
  google.charts.setOnLoadCallback(drawChart);
  var cpf = [15,10,8,6,5,2]
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
      ["Tipo Certificado", "Quantidade", { role: "style" } ],
      ['E-CPF A1 Midia Digital', cpf[0], '#0d6efd'],
      ['E-CPF A3 Cartao', cpf[1], '#0dcdfd'],
      ['E-CPF A3 Token', cpf[2], '#5d0dfd'],
      ['E-CPF A3 Cartao + Leitora', cpf[3], 'silver'],
      ['E-CPF A3 sem midia', cpf[4], 'gold'],
      ['(Outro tipo)', cpf[5], 'pink']
    ]);

    var view = new google.visualization.DataView(data);
    view.setColumns([0, 1,
                     { calc: "stringify", sourceColumn: 1, type: "string", role: "annotation" }, 2]);
    var options = {
      title: "Total de E-CPF",
      width: 600,
      height: 400,
      bar: {groupWidth: "85%"},
      legend: { position: "none" },
    };
    var chart = new google.visualization.BarChart(document.getElementById("e-cpf"));
    chart.draw(view, options);
}
</script>

<script type="text/javascript">
  google.charts.load("current", {packages:["corechart"]});
  google.charts.setOnLoadCallback(drawChart);
  var cnpj = [25,15,8,9,2,3]
  function drawChart() {
    var data = google.visualization.arrayToDataTable([
      ["Tipo Certificado", "Quantidade", { role: "style" } ],     
      ['E-CNPJ A1 Midia Digital', cnpj[0], '#125dcc'],
      ['E-CNPJ A3 Cartao', cnpj[1], 'red'],
      ['E-CNPJ A3 Token', cnpj[2], 'silver'],
      ['E-CNPJ A3 Cartao + Leitora', cnpj[3], 'cyan'],
      ['E-CNPJ A3 sem midia', cnpj[4], '#5012cc'],
      ['(Outro tipo)', cnpj[5], 'yellow'],
    ]);
    var view = new google.visualization.DataView(data);
    view.setColumns([0, 1,
                     { calc: "stringify", sourceColumn: 1, type: "string", role: "annotation" },2]);
    var options = {
      title: "Total de E-CNPJ",
      width: 600,
      height: 400,
      bar: {groupWidth: "85%"},
      legend: { position: "none" },
    };
    var chart = new google.visualization.BarChart(document.getElementById("e-cnpj"));
    chart.draw(view, options);
}
</script>
<section class="d-flex">
  <div class="ms-4 my-5 mx-auto" id="e-cpf" style="width: 50%;"></div>
  <div class="my-5 mx-auto" id="e-cnpj" style="width: 50%;"></div>
</section>
  
</main><script src="js/bootstrap.bundle.js"></script>
</body>
</html>